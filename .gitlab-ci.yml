include:
  - project: "experiments/control-templates"
    file: "/templates/gitlab-attest.yml"
    ref: main

stages:
  - build
  - test
  - deploy

build:
  extends: .attested_job
  stage: build
  script:
    - make build
  variables:
    ARTIFACT_PATH: "dist/output.jar"

test:
  extends: .attested_job
  stage: test
  script:
    - make test
    - echo "all tests passed" > dist/test-report.txt
  variables:
    ARTIFACT_PATH: "dist/test-report.txt"

deploy:
  extends: .attested_job
  stage: deploy
  script:
    - make deploy
    - echo "deployed to staging" > dist/deploy.log
  variables:
    ARTIFACT_PATH: "dist/deploy.log"
